# events_processing
An algorythm for the detection of calcium events in astrocytes
Состоит из нескольких функций: 
    1. events_processing - основная функция для обработки данных.
    2. def_params - функция, хранящая в себе дефолтные настройки.
    3. intensity_filter - функция для определения порога ithres.
       Вызывается в начале events_processing, другой вариант с использованием дефолтных параметров находится в комментарии.
       
Краткое описание events_processing.
Переменные, которые подаются на вход:
     data - исходные данные с сигналами клеток, по строкам клетки, по столбцам интенсивности в момент времени
     bwindow - окно для базовой линии
     window_e - окно для расчета событий
     baseline - базовая линия для дальнейшего расчета событий
     ithres - порог по интенсивности, выше которого будет событие (начальная разметка с базовой линией)
     dthres - порог по производной, ниже которого события нет (для разметки концов и начал)
Результат работы функции:
     temp_e - массив с определёнными событиями, где по строкам клетки, по столбцам ноль или один в зависимости от наличия события
     baseline - массив с рассчитанной базовой линией для каждой клетки, по строкам клетки, по столбцам значения интенсивности

Общее описание работы:
     По входным данным рассчитывается базовая линия с помощью повторения шагов сглаживания и выбора наименьших полученных значений интенсивности.
     Далее генерируются события, которые выше базовой линии на порог ithres, отсекаются короткие события (5 кадров и меньше).
     Потом первичные данные сглаживаются, высчитывается производная по сглаженным данным, на основании которой будет происходить точечная разметка концов и событий.
     Начала размечаются одинаково, границей события является смена знака производной минимум в двух кадрах из пяти.
     В зависимости от того, какое расстояние между двумя соседними событиями, будет отличаться алгоритм обработки концов. В обоих случаях рассматриваются следующие ситуации:
          1. Когда производная меньше нуля, но выше порога dthres по модулю - событие продолжается
          2. Когда производная меньше нуля, но ниже порога dthres по модулю - событие заканчивается (затухает)
          3. Когда производная выше нуля - событие заканчивается и, скорее всего, начинается новое. При близких событиях момент окончания будет на два кадра раньше первого положительного значения производной, при далеких - на один кадр раньше первого положительного значения производной.
     
